(this["webpackJsonpsweeper-react"]=this["webpackJsonpsweeper-react"]||[]).push([[0],{13:function(e,t,i){},14:function(e,t,i){},16:function(e,t,i){"use strict";i.r(t);var s,n=i(1),l=i.n(n),a=i(4),c=i.n(a),h=(i(13),i(2)),r=i(5),o=i(6),g=i(8),d=i(7),f=i.p+"static/media/closed.184e8340.svg",v=i.p+"static/media/flag.4b1e382d.svg",m=i.p+"static/media/mine.24812854.svg",b=i.p+"static/media/mine_red.f7e40740.svg",p=i.p+"static/media/mine_wrong.e388c6ce.svg",u=i.p+"static/media/face_unpressed.0a00432f.svg",I=i.p+"static/media/face_pressed.3b633818.svg",w=i.p+"static/media/face_lose.b71d4bee.svg",L=i.p+"static/media/face_win.347d5c73.svg",B=(i(14),i(0));!function(e){e[e.HIDE=0]="HIDE",e[e.SHOW=1]="SHOW",e[e.FLAG=2]="FLAG"}(s||(s={}));var S=function(e){Object(g.a)(i,e);var t=Object(d.a)(i);function i(e){var s;return Object(r.a)(this,i),(s=t.call(this,e)).topCanvasRef=void 0,s.canvasRef=void 0,s.cellBgImg=void 0,s.flagBgImg=void 0,s.mineBgImg=void 0,s.mineRedBgImg=void 0,s.mineWrongBgImg=void 0,s.faceUnpressedBgImg=void 0,s.facePressedBgImg=void 0,s.faceLoseBgImg=void 0,s.faceWinBgImg=void 0,s.lines=9,s.rows=9,s.bombs=10,s.cellLen=30,s.canvasWidth=s.cellLen*s.rows,s.canvasHeight=s.cellLen*s.lines,s.topCanvasHeight=2*s.cellLen,s.cells=void 0,s.cellStates=void 0,s.bomb=!1,s.win=!1,s.flags=0,s.beginTime=0,s.finishedAt=0,s.resetting=0,s.topCanvas=void 0,s.topCtx=void 0,s.canvas=void 0,s.ctx=void 0,s.state={level:1},s.topCanvasRef=l.a.createRef(),s.canvasRef=l.a.createRef(),s.cellBgImg=new Image,s.flagBgImg=new Image,s.mineBgImg=new Image,s.mineRedBgImg=new Image,s.mineWrongBgImg=new Image,s.faceUnpressedBgImg=new Image,s.facePressedBgImg=new Image,s.faceLoseBgImg=new Image,s.faceWinBgImg=new Image,s.initBombs(),s}return Object(o.a)(i,[{key:"initBombs",value:function(){for(var e=[],t=[],i=0;i<this.lines;i++){for(var n=[],l=[],a=0;a<this.rows;a++)n.push(0),l.push(s.HIDE);e.push(n),t.push(l)}this.cells=e,this.cellStates=t;for(var c=this.lines*this.rows,h=new Set;h.size<this.bombs;)h.add(Math.floor(Math.random()*c));for(var r=0,o=Array.from(h);r<o.length;r++){var g=o[r],d=Math.floor(g/this.rows),f=g%this.rows;e[d][f]=-1}for(var v=0;v<this.lines;v++)for(var m=0;m<this.rows;m++)this.setCellValue(v,m)}},{key:"componentDidMount",value:function(){var e=this,t=this.topCanvas=this.topCanvasRef.current;this.topCtx=t.getContext("2d");var i=this.canvas=this.canvasRef.current;this.ctx=i.getContext("2d");var n=function(e){return new Promise((function(t){e.onload=t}))};Promise.all([n(this.cellBgImg),n(this.flagBgImg),n(this.mineBgImg),n(this.mineRedBgImg),n(this.mineWrongBgImg),n(this.faceUnpressedBgImg),n(this.facePressedBgImg),n(this.faceLoseBgImg),n(this.faceWinBgImg)]).then((function(){e.drawTop(),e.draw()})),this.cellBgImg.src=f,this.flagBgImg.src=v,this.mineBgImg.src=m,this.mineRedBgImg.src=b,this.mineWrongBgImg.src=p,this.faceUnpressedBgImg.src=u,this.facePressedBgImg.src=I,this.faceLoseBgImg.src=w,this.faceWinBgImg.src=L;var l=function(){0===e.beginTime&&(e.beginTime=Date.now(),window.requestAnimationFrame(e.drawTop.bind(e)))};t.addEventListener("click",(function(t){if(e.beginTime){var i=e.topCanvas.getBoundingClientRect(),s=t.clientX-i.left,n=t.clientY-i.top,l=1.5*e.cellLen,a=e.canvasWidth/2-l/2,c=e.topCanvasHeight/2-l/2;s>a&&s<a+l&&n>c&&n<c+l&&e.reset()}})),t.addEventListener("contextmenu",(function(e){e.preventDefault()}));var a=function(){if(!e.bomb&&!e.win){for(var t=0;t<e.lines;t++)for(var i=0;i<e.rows;i++){if(e.cellStates[t][i]===s.HIDE&&-1!==e.cells[t][i])return;if(e.cellStates[t][i]===s.FLAG&&-1!==e.cells[t][i])return}e.win=!0,e.finishedAt=Date.now();for(var n=0;n<e.lines;n++)for(var l=0;l<e.rows;l++)e.cellStates[n][l]===s.HIDE&&-1===e.cells[n][l]&&(e.cellStates[n][l]=s.FLAG)}};i.addEventListener("click",(function(t){if(l(),!e.bomb){var i=e.getCellIndexFromEvent(t),s=Object(h.a)(i,2),n=s[0],c=s[1];e.showCell(n,c),a(),e.draw()}})),i.addEventListener("contextmenu",(function(t){if(t.preventDefault(),l(),!e.bomb){var i=e.getCellIndexFromEvent(t),n=Object(h.a)(i,2),c=n[0],r=n[1];e.cellStates[c][r]!==s.SHOW&&(e.cellStates[c][r]===s.FLAG?(e.cellStates[c][r]=s.HIDE,e.flags--):(e.cellStates[c][r]=s.FLAG,e.flags++),a(),e.draw())}}))}},{key:"reset",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&(this.resetting=Date.now()),this.win=!1,this.bomb=!1,this.flags=0,this.beginTime=0,this.finishedAt=0,this.initBombs(),this.drawTop(),this.draw()}},{key:"drawTop",value:function(){var e=this.topCtx;e.clearRect(0,0,this.canvasWidth,this.topCanvasHeight);var t=1.5*this.cellLen,i=this.canvasWidth/2-t/2,s=this.topCanvasHeight/2-t/2;this.resetting&&(this.beginTime||Date.now()-this.resetting>150)&&(this.resetting=0),this.resetting?e.drawImage(this.facePressedBgImg,i,s,t,t):this.win?e.drawImage(this.faceWinBgImg,i,s,t,t):this.bomb?e.drawImage(this.faceLoseBgImg,i,s,t,t):e.drawImage(this.faceUnpressedBgImg,i,s,t,t),e.font="bold ".concat(1.5*this.cellLen,"px serif"),e.fillStyle="red",e.textBaseline="top";var n=this.bombs-this.flags,l=String(n).padStart(3,"0");e.fillText(l,this.cellLen/2,this.topCanvasHeight/2-1.5*this.cellLen/2);var a=0===this.beginTime?0:Math.floor((Date.now()-this.beginTime)/1e3),c=String(a).padStart(3,"0"),h=e.measureText(c);e.fillText(c,this.canvasWidth-h.width-this.cellLen/2,this.topCanvasHeight/2-1.5*this.cellLen/2),(this.beginTime&&!this.bomb&&!this.win||this.resetting)&&window.requestAnimationFrame(this.drawTop.bind(this))}},{key:"draw",value:function(){var e=this.ctx;e.clearRect(0,0,this.canvasWidth,this.canvasHeight),e.beginPath(),e.lineWidth=2,e.strokeStyle="#808080";for(var t=1;t<this.lines;t++)e.moveTo(0,t*this.cellLen),e.lineTo(this.canvasWidth,t*this.cellLen);for(var i=1;i<this.rows;i++)e.moveTo(i*this.cellLen,0),e.lineTo(i*this.cellLen,this.canvasHeight);e.stroke(),e.font="bold ".concat(this.cellLen,"px serif"),e.textBaseline="top";for(var n=0;n<this.lines;n++)for(var l=0;l<this.rows;l++)if(this.cells[n][l]>0){1===this.cells[n][l]?e.fillStyle="#00f":2===this.cells[n][l]?e.fillStyle="#008001":3===this.cells[n][l]?e.fillStyle="#ff0000":4===this.cells[n][l]?e.fillStyle="#000080":(this.cells[n][l],e.fillStyle="#800001");var a=String(this.cells[n][l]),c=e.measureText(a);e.fillText(a,l*this.cellLen+(this.cellLen-c.width)/2,n*this.cellLen)}for(var h=0;h<this.lines;h++)for(var r=0;r<this.rows;r++)this.bomb&&-1===this.cells[h][r]?this.cellStates[h][r]===s.SHOW?e.drawImage(this.mineRedBgImg,r*this.cellLen,h*this.cellLen,this.cellLen,this.cellLen):this.cellStates[h][r]===s.HIDE?e.drawImage(this.mineBgImg,r*this.cellLen,h*this.cellLen,this.cellLen,this.cellLen):e.drawImage(this.flagBgImg,r*this.cellLen,h*this.cellLen,this.cellLen,this.cellLen):this.cellStates[h][r]===s.HIDE?e.drawImage(this.cellBgImg,r*this.cellLen,h*this.cellLen,this.cellLen,this.cellLen):this.cellStates[h][r]===s.FLAG&&(this.bomb?e.drawImage(this.mineWrongBgImg,r*this.cellLen,h*this.cellLen,this.cellLen,this.cellLen):e.drawImage(this.flagBgImg,r*this.cellLen,h*this.cellLen,this.cellLen,this.cellLen))}},{key:"setCellValue",value:function(e,t){var i=this.cells;if(-1!==i[e][t]){var s=0;[[e-1,t-1],[e-1,t],[e-1,t+1],[e,t-1],[e,t+1],[e+1,t-1],[e+1,t],[e+1,t+1]].forEach((function(e){var t=Object(h.a)(e,2),n=t[0],l=t[1];-1===(i[n]||[])[l]&&s++})),i[e][t]=s}}},{key:"showCell",value:function(e,t){var i=this,n=this.cellStates[e][t];if(n!==s.SHOW&&n!==s.FLAG){if(-1===this.cells[e][t])return this.cellStates[e][t]=s.SHOW,this.bomb=!0,void(this.finishedAt=Date.now());for(var l=[[e,t]];l.length;){var a=l.shift(),c=Object(h.a)(a,2),r=c[0],o=c[1];this.cellStates[r][o]!==s.SHOW&&this.cellStates[r][o]!==s.FLAG&&(this.cellStates[r][o]=s.SHOW,0===this.cells[r][o]&&[[r-1,o-1],[r-1,o],[r-1,o+1],[r,o-1],[r,o+1],[r+1,o-1],[r+1,o],[r+1,o+1]].forEach((function(e){var t=Object(h.a)(e,2),s=t[0],n=t[1];s>=0&&n>=0&&s<i.rows&&n<i.lines&&l.push([s,n])})))}}}},{key:"getCellIndexFromEvent",value:function(e){var t=this.canvas.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top;return[Math.floor(s/this.cellLen),Math.floor(i/this.cellLen)]}},{key:"setLevel",value:function(e){var t=this;e!==this.state.level&&(1===e?(this.lines=9,this.rows=9,this.bombs=10):2===e?(this.lines=16,this.rows=16,this.bombs=40):3===e&&(this.lines=16,this.rows=30,this.bombs=99),this.canvasWidth=this.cellLen*this.rows,this.canvasHeight=this.cellLen*this.lines,this.setState({level:e},(function(){t.reset(!1)})))}},{key:"render",value:function(){var e=this,t=this.state.level;return Object(B.jsxs)("div",{className:"App",children:[Object(B.jsx)("p",{children:"\u626b\u96f7"}),Object(B.jsxs)("p",{children:[Object(B.jsx)("span",{onClick:function(){e.setLevel(1)},style:{marginRight:"20px",cursor:"pointer"},className:1===t?"level-selected":void 0,children:"\u521d\u7ea7"}),Object(B.jsx)("span",{onClick:function(){e.setLevel(2)},style:{marginRight:"20px",cursor:"pointer"},className:2===t?"level-selected":void 0,children:"\u4e2d\u7ea7"}),Object(B.jsx)("span",{onClick:function(){e.setLevel(3)},style:{cursor:"pointer"},className:3===t?"level-selected":void 0,children:"\u9ad8\u7ea7"})]}),Object(B.jsx)("div",{children:Object(B.jsx)("div",{style:{display:"inline-block",padding:"10px",paddingBottom:0,background:"#c6c6c6"},children:Object(B.jsx)("canvas",{ref:this.topCanvasRef,style:{border:"4px solid #808080",borderRightColor:"#fff",borderBottomColor:"#fff"},width:this.canvasWidth,height:this.topCanvasHeight})})}),Object(B.jsx)("div",{children:Object(B.jsx)("div",{style:{display:"inline-block",padding:"10px",background:"#c6c6c6"},children:Object(B.jsx)("canvas",{ref:this.canvasRef,style:{border:"4px solid #808080",borderRightColor:"#fff",borderBottomColor:"#fff"},width:this.canvasWidth,height:this.canvasHeight})})})]})}}]),i}(l.a.Component),x=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,17)).then((function(t){var i=t.getCLS,s=t.getFID,n=t.getFCP,l=t.getLCP,a=t.getTTFB;i(e),s(e),n(e),l(e),a(e)}))};c.a.render(Object(B.jsx)(l.a.StrictMode,{children:Object(B.jsx)(S,{})}),document.getElementById("root")),x()}},[[16,1,2]]]);
//# sourceMappingURL=main.4dee0da7.chunk.js.map